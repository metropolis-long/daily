<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.daily.dao.my.EventDao">
  <resultMap id="BaseResultMap" type="com.daily.dto.EventDTO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="event_id" jdbcType="BIGINT" property="eventId" />
    <result column="time_cost" jdbcType="DECIMAL" property="timeCost" />
    <result column="user_id" jdbcType="BIGINT" property="userId" />
    <result column="plan_time" jdbcType="TIMESTAMP" property="planTime" />
    <result column="status_id" jdbcType="INTEGER" property="statusId" />
    <result column="created" jdbcType="TIMESTAMP" property="created" />
    <result column="updated" jdbcType="TIMESTAMP" property="updated" />
    <result column="event_context" jdbcType="LONGVARCHAR" property="eventContext" />
  </resultMap>
  <select id="eventList" resultType="com.daily.dto.EventDTO">
    select  * from event
    <include refid="event_sql"/>
<!--    <if test="page != null">-->
<!--      limit #{page.begin},#{page.length}-->
<!--    </if>-->
  </select>
  <select id="count4EventList" resultType="int">
    select count(*) from (
        select * from event
        <include refid="event_sql"/>
    ) t
  </select>
  <select id="eventRemindList" resultType="com.daily.dto.EventDTO">
    select  * from event
    left join user_info on user_info.user_id = event.user_id
    where email is not null
    and remind =1
    and `event`.deleted =0
    and remind_time &lt;= now()
    <if test="userId != null">
      and `event`.user_id =#{userId}
    </if>
  </select>
  <sql id="event_sql">
    <where>
      <if test="userId != null"> and  user_id = #{userId} </if>
      <if test="timeCost != null"> and time_cost &gt;= #{timeCost} </if>
      <if test="keywords != null ">
        and event_context like #{keywordsLike}
      </if>
      <if test="statusId !=null">
        and status_id =  #{statusId}
      </if>
      <if test="planTime != null and planTime !=''">
        and DATE_FORMAT( plan_time, '%Y%m' ) = DATE_FORMAT( #{planTime} , '%Y%m' )
      </if>
      <if test="remindTime != null and remindTime !=''">
        and DATE_FORMAT( remind_time, '%Y%m' ) = DATE_FORMAT( #{remindTime} , '%Y%m' )
      </if>
    </where>
  </sql>
</mapper>